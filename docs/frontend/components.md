# Frontend компоненты

## Обзор

Frontend построен на Next.js 14 с использованием React 18, TailwindCSS для стилизации и TypeScript для типизации. Архитектура компонентов следует принципам композиции и переиспользования.

## Структура компонентов

```
frontend/components/
├── ui/                    # Базовые UI компоненты
│   ├── Alert.js          # Уведомления и алерты
│   ├── Badge.js          # Значки и статусы
│   ├── Button.js         # Кнопки различных типов
│   ├── Card.js           # Карточки контента
│   ├── Input.js          # Поля ввода
│   ├── PageHeader.js     # Заголовки страниц
│   ├── Table.js          # Таблицы данных
│   ├── Tabs.js           # Табы навигации
│   └── Toggle.js         # Переключатели
├── Layout.js             # Основной layout приложения
├── Navigation.js         # Навигационное меню
├── ProtectedRoute.js     # Защищенные маршруты
├── UserInfo.js           # Информация о пользователе
├── BitrixProjectSelector.js  # Селектор проектов Bitrix
├── ExpenseMonitoring.js  # Мониторинг расходов
├── FoundNews.js          # Отображение найденных новостей
├── PublicationInterface.js   # Интерфейс публикации
├── ProjectSelector.js    # Селектор проектов
└── SummaryConfirmation.js    # Подтверждение выжимки
```

## Базовые UI компоненты

### Alert.js
Компонент для отображения уведомлений и сообщений.

**Пропсы:**
- `type` - тип алерта (success, error, warning, info)
- `title` - заголовок сообщения
- `message` - текст сообщения
- `closable` - возможность закрыть
- `onClose` - функция закрытия

**Использование:**
```jsx
<Alert
  type="success"
  title="Успех"
  message="Операция выполнена успешно"
  closable={true}
  onClose={() => setShow(false)}
/>
```

### Button.js
Универсальный компонент кнопки с различными вариантами.

**Варианты:**
- `primary` - основная кнопка (синяя)
- `secondary` - вторичная кнопка (серая)
- `danger` - кнопка удаления (красная)
- `success` - кнопка успеха (зеленая)
- `outline` - кнопка с обводкой

**Размеры:**
- `sm` - маленькая
- `md` - средняя (по умолчанию)
- `lg` - большая

**Пропсы:**
- `variant` - вариант стиля
- `size` - размер кнопки
- `disabled` - заблокированное состояние
- `loading` - состояние загрузки
- `onClick` - обработчик клика
- `type` - тип кнопки (button, submit, reset)

**Использование:**
```jsx
<Button
  variant="primary"
  size="md"
  loading={isSubmitting}
  onClick={handleSubmit}
>
  Сохранить
</Button>
```

### Card.js
Компонент карточки для группировки контента.

**Пропсы:**
- `title` - заголовок карточки
- `subtitle` - подзаголовок
- `actions` - элементы действий (кнопки, меню)
- `className` - дополнительные CSS классы
- `padding` - внутренние отступы (sm, md, lg)

**Использование:**
```jsx
<Card
  title="Настройки проекта"
  subtitle="Конфигурация интеграции с Bitrix"
  actions={<Button variant="outline">Редактировать</Button>}
>
  {content}
</Card>
```

### Input.js
Универсальный компонент для полей ввода.

**Типы:**
- `text` - текстовое поле
- `email` - поле email
- `password` - поле пароля
- `number` - числовое поле
- `textarea` - многострочное поле
- `select` - выпадающий список

**Пропсы:**
- `type` - тип поля
- `label` - подпись поля
- `placeholder` - текст-заполнитель
- `value` - значение
- `onChange` - обработчик изменения
- `error` - сообщение об ошибке
- `required` - обязательное поле
- `disabled` - заблокированное состояние

**Использование:**
```jsx
<Input
  type="text"
  label="Название проекта"
  placeholder="Введите название"
  value={projectName}
  onChange={(e) => setProjectName(e.target.value)}
  error={errors.projectName}
  required
/>
```

### Table.js
Компонент таблицы с сортировкой и пагинацией.

**Пропсы:**
- `columns` - конфигурация колонок
- `data` - данные таблицы
- `sortable` - возможность сортировки
- `pagination` - настройки пагинации
- `loading` - состояние загрузки
- `onSort` - обработчик сортировки
- `onPageChange` - обработчик смены страницы

**Формат колонок:**
```javascript
const columns = [
  {
    key: 'title',
    label: 'Заголовок',
    sortable: true,
    render: (value, row) => <Link href={`/news/${row.id}`}>{value}</Link>
  },
  {
    key: 'source',
    label: 'Источник',
    width: '120px'
  },
  {
    key: 'created_at',
    label: 'Дата создания',
    sortable: true,
    render: (value) => formatDate(value)
  }
]
```

**Использование:**
```jsx
<Table
  columns={columns}
  data={articles}
  sortable={true}
  pagination={{
    page: currentPage,
    limit: 20,
    total: totalCount
  }}
  loading={isLoading}
  onSort={handleSort}
  onPageChange={setCurrentPage}
/>
```

### Tabs.js
Компонент для табовой навигации.

**Пропсы:**
- `tabs` - массив табов
- `activeTab` - активный таб
- `onChange` - обработчик смены таба
- `variant` - стиль табов (default, pills, underline)

**Формат табов:**
```javascript
const tabs = [
  { key: 'overview', label: 'Обзор', icon: 'chart' },
  { key: 'articles', label: 'Статьи', count: 150 },
  { key: 'settings', label: 'Настройки' }
]
```

### Badge.js
Компонент для отображения статусов и меток.

**Варианты:**
- `default` - серый
- `primary` - синий
- `success` - зеленый
- `warning` - желтый
- `danger` - красный

**Использование:**
```jsx
<Badge variant="success">Опубликовано</Badge>
<Badge variant="warning">Ожидает</Badge>
<Badge variant="danger">Ошибка</Badge>
```

## Составные компоненты

### Layout.js
Основной layout приложения с шапкой и навигацией.

**Функциональность:**
- Адаптивная шапка с логотипом
- Breadcrumbs навигация
- Информация о пользователе
- Адаптивная разметка

**Пропсы:**
- `title` - заголовок страницы
- `breadcrumbs` - хлебные крошки
- `headerRight` - дополнительные элементы в шапке
- `children` - содержимое страницы

**Использование:**
```jsx
<Layout
  title="Мониторинг системы"
  breadcrumbs={[
    { label: 'Главная', href: '/' },
    { label: 'Мониторинг' }
  ]}
  headerRight={<RefreshButton />}
>
  {content}
</Layout>
```

### Navigation.js
Главное навигационное меню приложения.

**Разделы:**
- Мониторинг - основная рабочая область
- Опубликованные - просмотр опубликованных новостей
- Расходы - аналитика затрат
- Настройки - конфигурация системы

**Функциональность:**
- Активный элемент меню
- Иконки разделов
- Счетчики уведомлений
- Адаптивность под разные экраны

### ProtectedRoute.js
Компонент для защиты маршрутов с проверкой аутентификации.

**Функциональность:**
- Проверка JWT токена
- Перенаправление на login при отсутствии токена
- Загрузка информации о пользователе
- Контекст аутентификации

**Использование:**
```jsx
<ProtectedRoute requiredRole="admin">
  <AdminPanel />
</ProtectedRoute>
```

### UserInfo.js
Компонент отображения информации о текущем пользователе.

**Функциональность:**
- Имя пользователя и роль
- Выпадающее меню с действиями
- Выход из системы
- Переключение проектов

## Специализированные компоненты

### FoundNews.js
Компонент для отображения результатов парсинга новостей.

**Функциональность:**
- Список найденных статей
- Фильтрация по источникам
- Превью контента статей
- Действия с отдельными статьями

**Пропсы:**
- `articles` - массив статей
- `loading` - состояние загрузки
- `onArticleSelect` - выбор статьи
- `onGenerateSummary` - создание выжимки

### PublicationInterface.js
Интерфейс для управления публикациями новостей.

**Функциональность:**
- Просмотр сгенерированного контента
- Редактирование SEO данных
- Выбор проекта для публикации
- Планирование публикации
- Превью результата

**Разделы:**
- Основной контент новости
- SEO настройки (заголовок, описание, ключевые слова)
- Изображение (генерация/перегенерация)
- Telegram анонс
- Настройки публикации

### SummaryConfirmation.js
Компонент для редактирования и подтверждения выжимки статьи.

**Функциональность:**
- Отображение автоматически созданной выжимки
- Редактирование текста выжимки
- Управление списком фактов
- Подтверждение для генерации

**Состояния:**
- Просмотр выжимки
- Редактирование
- Подтверждение изменений

### ProjectSelector.js
Селектор проектов для генерации новостей.

**Функциональность:**
- Выбор целевого проекта
- Отображение информации о проекте
- Валидация доступности проекта

**Проекты:**
- Гинекология (gynecology.school)
- Терапия (therapy.school)
- Педиатрия (pediatrics.school)
- RusMedical (общий проект)

### BitrixProjectSelector.js
Селектор проектов Bitrix для публикации.

**Функциональность:**
- Выбор целевого проекта Bitrix
- Отображение настроек интеграции
- Проверка доступности API

### ExpenseMonitoring.js
Компонент мониторинга расходов системы.

**Функциональность:**
- Статистика расходов по периодам
- Группировка по проектам и типам
- Детальная таблица расходов
- Экспорт данных

**Виджеты:**
- Общие расходы за период
- Топ пользователей по расходам
- Распределение по типам операций
- График динамики расходов

## Контексты

### AuthContext.js
React контекст для управления состоянием аутентификации.

**Состояние:**
- `user` - информация о пользователе
- `token` - JWT токен
- `isAuthenticated` - статус аутентификации
- `loading` - состояние загрузки

**Методы:**
- `login(credentials)` - вход в систему
- `logout()` - выход из системы
- `refreshUser()` - обновление данных пользователя

**Использование:**
```jsx
const { user, isAuthenticated, login, logout } = useAuth()

// Вход в систему
await login({ username, password })

// Выход
logout()

// Проверка роли
if (user?.role === 'admin') {
  // Админские функции
}
```

## Утилиты

### api.js
Настроенный Axios клиент для API запросов.

**Функции:**
- Автоматическое добавление JWT токена
- Обработка ошибок аутентификации
- Интерцепторы запросов и ответов
- Таймауты и retry логика

**Методы:**
```javascript
// GET запрос
const articles = await apiClient.get('/api/news/articles')

// POST запрос
const result = await apiClient.post('/api/news/parse', {
  sources: ['ria'],
  max_articles: 10
})

// Обработка ошибок
try {
  await apiClient.post('/api/news-generation/publish', data)
} catch (error) {
  if (error.response?.status === 401) {
    // Перенаправление на login
  }
}
```

### timezone.js
Утилиты для работы с часовыми поясами.

**Функции:**
- Конвертация в московское время
- Форматирование дат
- Relative time (как давно)

## Стилизация

### TailwindCSS
Основная система стилизации с кастомной конфигурацией.

**Кастомные цвета:**
```javascript
module.exports = {
  theme: {
    extend: {
      colors: {
        primary: {
          50: '#eff6ff',
          500: '#3b82f6',
          600: '#2563eb',
          700: '#1d4ed8'
        }
      }
    }
  }
}
```

**Utility классы:**
- Адаптивная сетка и flexbox
- Spacing система
- Типографика и цвета
- Анимации и переходы

### CSS модули
Для специфичных стилей используются CSS модули с префиксом компонента.

## Адаптивность

### Breakpoints
- `sm` - 640px (планшеты)
- `md` - 768px (планшеты в альбомной ориентации)
- `lg` - 1024px (ноутбуки)
- `xl` - 1280px (десктопы)

### Мобильная оптимизация
- Touch-friendly кнопки и элементы
- Адаптивная навигация (гамбургер меню)
- Оптимизированные таблицы (горизонтальный скролл)
- Responsive изображения

## Производительность

### Оптимизации
- Ленивая загрузка компонентов (React.lazy)
- Мемоизация дорогих вычислений (useMemo, useCallback)
- Виртуализация длинных списков
- Оптимизация изображений (Next.js Image)

### Code splitting
```javascript
// Ленивая загрузка страниц
const MonitoringPage = lazy(() => import('../pages/monitoring'))

// Условная загрузка компонентов
const AdminPanel = lazy(() => import('../components/AdminPanel'))
```

## Тестирование

### Структура тестов
```
frontend/__tests__/
├── components/
│   ├── Layout.test.js
│   ├── Button.test.js
│   └── Table.test.js
├── pages/
│   └── monitoring.test.js
└── utils/
    └── api.test.js
```

### Подходы к тестированию
- Unit тесты для утилит и чистых функций
- Component тесты для UI компонентов
- Integration тесты для страниц
- E2E тесты для критических пользовательских сценариев

### Инструменты
- Jest - основной тестовый фреймворк
- React Testing Library - тестирование компонентов
- MSW - мокирование API запросов
- Cypress - E2E тестирование

## Развитие

### Планируемые улучшения
- Темная тема интерфейса
- Расширенная система уведомлений
- Drag & drop функциональность
- Оффлайн поддержка
- PWA возможности

### Техдолг
- Миграция на TypeScript для всех компонентов
- Добавление Storybook для документации компонентов
- Улучшение accessibility (a11y)
- Оптимизация bundle size